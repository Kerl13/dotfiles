#!/bin/sh

set -euC

export LANG=EN_us
readonly mike_name="$(pactl info | grep '^Default Source:' | cut -d' ' -f3)"
readonly mike_id="$(pactl list short | grep "${mike_name}[^.]" | cut -f1)"

get_mike_status () {
  # This is horrible!
  readonly is_mute="$(pactl list sources |\
    sed -z "s/.*Source #${mike_id}.*Mute: \([a-z]*\).*/\\1/")"
  if [ "$is_mute" = "no" ]; then
    echo "on"
  else
    echo "off"
  fi
}

# Command line interface

usage () {
  echo "$0 [get|toggle]"
}

cmdline () {
  if [ $# = 0 ]; then return 1; fi

  case "$1" in
    "get") get_mike_status ;;
    "toggle") pactl set-source-mute "$mike_id" toggle ; get_mike_status ;;
    "*") return 1
  esac
}

# Main entry point

cmdline "$@" || usage
